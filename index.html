<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coffee Shop — Live Orders Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --coffee: #6b4f3b;        /* primary */
      --latte: #f7efe7;         /* background */
      --mocha: #3f2f25;         /* dark */
      --foam: #fffdf9;          /* card bg */
      --mint: #16a34a;          /* success */
      --amber: #f59e0b;         /* warn */
      --rose: #e11d48;          /* danger */
    }
    html{font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"}
  </style>
</head>
<body class="bg-[var(--latte)] text-[var(--mocha)]">
  <!-- Header -->
  <header class="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-[var(--foam)]/80 bg-[var(--foam)]/95 border-b border-amber-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 grid place-items-center rounded-xl bg-[var(--coffee)] text-white font-bold">☕</div>
        <div>
          <h1 class="text-xl sm:text-2xl font-semibold">Live Orders Dashboard</h1>
          <p class="text-xs text-neutral-500 -mt-0.5">Coffee · Pastries · Snacks</p>
        </div>
      </div>
      <div class="flex flex-wrap items-center gap-2">
        <button id="addDemoBtn" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-sm font-medium border border-neutral-300 bg-white hover:bg-neutral-50">+ Add Demo Order</button>
        <div class="hidden sm:flex items-center gap-2">
          <label class="text-sm text-neutral-600">Auto-refresh</label>
          <select id="refreshSelect" class="px-3 py-1.5 rounded-xl border border-neutral-300 text-sm">
            <option value="off">Off</option>
            <option value="5">Every 5s</option>
            <option value="10">Every 10s</option>
            <option value="30">Every 30s</option>
            <option value="60">Every 60s</option>
          </select>
        </div>
        <button id="tickBtn" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-sm font-medium border border-neutral-300 bg-white hover:bg-neutral-50">↻ Refresh Now</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 grid grid-cols-1 lg:grid-cols-[1fr,24rem] gap-6">
    <!-- Main Column -->
    <section class="space-y-6">
      <!-- Summary Bar -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
        <div class="flex items-center gap-3 p-4 bg-[var(--foam)] rounded-2xl shadow-sm ring-1 ring-neutral-200">
          <div>
            <div class="text-xs text-neutral-500">Total Orders</div>
            <div id="kpiTotal" class="text-2xl font-semibold">0</div>
          </div>
        </div>
        <div class="flex items-center gap-3 p-4 bg-[var(--foam)] rounded-2xl shadow-sm ring-1 ring-neutral-200">
          <div>
            <div class="text-xs text-neutral-500">Ready / Pending</div>
            <div class="text-2xl font-semibold"><span id="kpiReady">0</span> / <span id="kpiPending">0</span></div>
          </div>
        </div>
        <div class="flex items-center gap-3 p-4 bg-[var(--foam)] rounded-2xl shadow-sm ring-1 ring-neutral-200">
          <div>
            <div class="text-xs text-neutral-500">Total Revenue (today)</div>
            <div id="kpiRevenue" class="text-2xl font-semibold">₹0.00</div>
          </div>
        </div>
        <div class="flex items-center gap-3 p-4 bg-[var(--foam)] rounded-2xl shadow-sm ring-1 ring-neutral-200">
          <div>
            <div class="text-xs text-neutral-500">Top Item in Queue</div>
            <div id="kpiTop" class="text-sm font-medium">–</div>
          </div>
        </div>
      </div>

      <!-- Smart Assistant -->
      <div class="bg-[var(--foam)] rounded-2xl ring-1 ring-neutral-200 shadow-sm p-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Smart Assistant</h2>
          <button id="regenSuggestions" class="px-3 py-1.5 rounded-lg border border-neutral-300 text-sm hover:bg-neutral-50">Regenerate</button>
        </div>
        <div id="suggestions" class="mt-3 grid gap-2"></div>
      </div>

      <!-- Orders Grid Controls -->
      <div class="flex flex-wrap items-center gap-2">
        <input id="searchInput" type="search" placeholder="Search by customer or item…" class="w-full sm:w-72 px-3 py-2 rounded-xl border border-neutral-300">
        <select id="filterStatus" class="px-3 py-2 rounded-xl border border-neutral-300">
          <option value="all">All Status</option>
          <option>waiting</option>
          <option>in progress</option>
          <option>ready</option>
          <option>cancelled</option>
        </select>
        <select id="filterPay" class="px-3 py-2 rounded-xl border border-neutral-300">
          <option value="all">All Payments</option>
          <option>cash</option>
          <option>card</option>
          <option>upi</option>
        </select>
        <button id="clearFilters" class="px-3 py-2 rounded-xl border border-neutral-300 bg-white hover:bg-neutral-50">Clear</button>
      </div>

      <!-- Orders Grid -->
      <div id="orderGrid" class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3"></div>
    </section>

    <!-- Sidebar / Alerts -->
    <aside class="space-y-4 lg:w-96 w-full">
      <div class="bg-[var(--foam)] rounded-2xl ring-1 ring-neutral-200 shadow-sm p-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Alerts</h2>
          <span id="alertCount" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-rose-50 text-[var(--rose)] ring-1 ring-rose-200">0</span>
        </div>
        <div id="alerts" class="mt-3 grid gap-2"></div>
      </div>

      <div class="bg-[var(--foam)] rounded-2xl ring-1 ring-neutral-200 shadow-sm p-4">
        <h2 class="text-lg font-semibold">Add Demo Orders</h2>
        <p class="text-sm text-neutral-600 mt-1">Seed the dashboard with randomized orders.</p>
        <div class="mt-3 flex items-center gap-2">
          <input id="seedCount" type="number" min="1" max="100" value="5" class="w-24 px-3 py-2 rounded-xl border border-neutral-300">
          <button id="seedBtn" class="px-4 py-2 rounded-xl text-white" style="background-color: var(--coffee);">Seed</button>
        </div>
      </div>
    </aside>
  </main>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-xs text-neutral-500">
    Built with Tailwind + Vanilla JS • Single-file demo
  </footer>

  <script>
    // ------------------------------
    // Data Types & State
    // ------------------------------
    /**
     * @typedef {Object} Order
     * @property {string} id
     * @property {string} customer
     * @property {{name:string, qty:number, price:number, type:'drink'|'pastry'|'snack'}[]} items
     * @property {'waiting'|'in progress'|'ready'|'cancelled'} status
     * @property {'cash'|'card'|'upi'} payment
     * @property {number} createdAt // epoch ms
     * @property {number} updatedAt // epoch ms
     */

    const state = {
      orders: /** @type {Order[]} */([]),
      filtered: /** @type {Order[]} */([]),
      intervalId: null,
    };

    const MENU = {
      drink: [
        {name:'Espresso', price:140},
        {name:'Americano', price:160},
        {name:'Cappuccino', price:180},
        {name:'Latte', price:190},
        {name:'Mocha', price:210},
        {name:'Cold Brew', price:220}
      ],
      pastry: [
        {name:'Croissant', price:120},
        {name:'Muffin', price:90},
        {name:'Banana Bread', price:110},
        {name:'Cinnamon Roll', price:130}
      ],
      snack: [
        {name:'Bagel', price:80},
        {name:'Granola Bar', price:70},
        {name:'Cookie', price:60},
        {name:'Samosa', price:50},
      ]
    };

    const NAMES = ['Aarav','Diya','Ishaan','Kabir','Myra','Rhea','Vivaan','Zara','Arjun','Ananya','Rahul','Neha','Kunal','Meera'];

    const $ = (sel)=>document.querySelector(sel);
    const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
    const now = ()=>Date.now();

    const rupee = (n)=>`₹${n.toFixed(2)}`;

    function orderTotal(o){
      if (o.status==='cancelled') return 0;
      return o.items.reduce((s,it)=>s + it.price*it.qty, 0);
    }

    function fmtTime(ms){
      const d = new Date(ms);
      return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }

    function minutesSince(ms){ return Math.floor((now()-ms)/60000); }

    function id(){ return 'ORD-' + Math.random().toString(36).slice(2,7).toUpperCase(); }

    // ------------------------------
    // Summary KPIs
    // ------------------------------
    function updateKPIs(){
      const list = state.filtered.length ? state.filtered : state.orders;
      const ready = list.filter(o=>o.status==='ready').length;
      const pending = list.filter(o=>o.status==='waiting' || o.status==='in progress').length;
      const revenue = list.reduce((s,o)=>s + orderTotal(o), 0);
      const top = topItemInQueue(state.orders.filter(o=>o.status!=='cancelled'));
      $('#kpiTotal').textContent = list.length;
      $('#kpiReady').textContent = ready;
      $('#kpiPending').textContent = pending;
      $('#kpiRevenue').textContent = rupee(revenue);
      $('#kpiTop').textContent = top || '–';
    }

    function topItemInQueue(list){
      const counts = {};
      list.forEach(o=>{
        o.items.forEach(it=>{ counts[it.name] = (counts[it.name]||0)+it.qty; })
      });
      let best = null, max = 0;
      Object.entries(counts).forEach(([name,qty])=>{ if (qty>max){max=qty;best=name;} });
      return best;
    }

    // ------------------------------
    // Rendering
    // ------------------------------
    function statusBadge(s){
      const map = {
        'waiting': 'bg-amber-50 text-[var(--amber)] ring-1 ring-amber-200',
        'in progress': 'bg-blue-50 text-blue-700 ring-1 ring-blue-200',
        'ready': 'bg-emerald-50 text-[var(--mint)] ring-1 ring-emerald-200',
        'cancelled': 'bg-rose-50 text-[var(--rose)] ring-1 ring-rose-200'
      };
      return `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${map[s]}">${s}</span>`;
    }

    function renderOrders(){
      const wrap = $('#orderGrid');
      const list = state.filtered.length ? state.filtered : state.orders;
      wrap.innerHTML = list.map(o=>{
        const itemsHtml = o.items.map(it=>`<li class="flex justify-between"><span>${it.name} × ${it.qty}</span><span class="text-neutral-500">${rupee(it.price*it.qty)}</span></li>`).join('');
        const controlsDisabled = o.status==='cancelled' ? 'opacity-50 pointer-events-none' : '';
        return `
          <div class="p-4 rounded-2xl bg-[var(--foam)] ring-1 ring-neutral-200 shadow-sm flex flex-col gap-3">
            <div class="flex items-start justify-between">
              <div>
                <div class="text-xs text-neutral-500">Order</div>
                <div class="font-semibold">${o.id}</div>
              </div>
              <div class="text-right">
                ${statusBadge(o.status)}
                <div class="text-[11px] text-neutral-500 mt-1">${o.payment} • ${fmtTime(o.createdAt)}</div>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-2 text-sm">
              <div>
                <div class="text-xs text-neutral-500 mb-1">Customer</div>
                <div class="font-medium">${o.customer}</div>
              </div>
              <div>
                <div class="text-xs text-neutral-500 mb-1">Total</div>
                <div class="font-semibold">${rupee(orderTotal(o))}</div>
              </div>
            </div>

            <div>
              <div class="text-xs text-neutral-500 mb-1">Items</div>
              <ul class="space-y-1">${itemsHtml}</ul>
            </div>

            <div class="mt-2 flex flex-wrap gap-2 ${controlsDisabled}">
              ${o.status==='waiting' ? `<button class="px-3 py-1.5 rounded-xl text-sm font-medium border border-neutral-300 bg-white hover:bg-neutral-50" data-action="start" data-id="${o.id}">Start</button>`: ''}
              ${o.status==='in progress' ? `<button class="px-3 py-1.5 rounded-xl text-sm font-medium border border-neutral-300 bg-white hover:bg-neutral-50" data-action="ready" data-id="${o.id}">Mark Ready</button>`: ''}
              ${o.status==='ready' ? `<button class="px-3 py-1.5 rounded-xl text-sm font-medium border border-neutral-300 bg-white hover:bg-neutral-50" data-action="reopen" data-id="${o.id}">Reopen</button>`: ''}
              ${o.status!=='cancelled' ? `<button class="px-3 py-1.5 rounded-xl text-sm font-medium text-white" style="background-color: var(--rose);" data-action="cancel" data-id="${o.id}">Cancel</button>`: ''}
            </div>

            ${o.status!=='cancelled' ? `<div class="text-[11px] text-neutral-500">Waiting: ${minutesSince(o.createdAt)} min</div>`: ''}
          </div>
        `;
      }).join('');
      wrap.querySelectorAll('[data-action]').forEach(btn=>btn.addEventListener('click', handleAction));
      updateKPIs();
    }

    // ------------------------------
    // Alerts
    // ------------------------------
    function buildAlerts(){
      const alerts = [];
      for (const o of state.orders){
        if (o.status!=='cancelled' && o.status!=='ready' && minutesSince(o.createdAt) > 10){
          alerts.push({kind:'bad', text:`Long wait: ${o.id}` , note:`Waiting ${minutesSince(o.createdAt)} min for ${o.customer}`});
        }
        const itemCount = o.items.reduce((s,it)=>s+it.qty,0);
        if (itemCount >= 6 && o.status!=='cancelled'){
          alerts.push({kind:'warn', text:`Large group: ${o.id}`, note:`${itemCount} items for ${o.customer}`});
        }
        if (o.status==='cancelled'){
          alerts.push({kind:'bad', text:`Cancelled: ${o.id}`, note:`Removed from revenue tallies`});
        }
      }
      return alerts;
    }

    function renderAlerts(){
      const list = buildAlerts();
      $('#alertCount').textContent = list.length;
      $('#alerts').innerHTML = list.map(a=>{
        const cls = a.kind==='bad' ? 'bg-rose-50 ring-rose-200 text-[var(--rose)]' : a.kind==='good' ? 'bg-emerald-50 ring-emerald-200 text-[var(--mint)]' : 'bg-amber-50 ring-amber-200 text-[var(--amber)]';
        return `<div class="p-3 rounded-xl ring-1 ${cls}">
          <div class="font-medium">${a.text}</div>
          <div class="text-xs mt-0.5 opacity-80">${a.note}</div>
        </div>`
      }).join('');
    }

    // ------------------------------
    // Smart Assistant
    // ------------------------------
    function generateSuggestions(){
      const pending = state.orders.filter(o=>o.status==='waiting' || o.status==='in progress');
      const longWaits = pending.filter(o=>minutesSince(o.createdAt)>10);
      const counts = {};
      pending.forEach(o=>o.items.forEach(it=>{
        counts[it.name]=(counts[it.name]||0)+it.qty;
      }));
      // top item
      let topName=null, topQty=0;
      for (const [k,v] of Object.entries(counts)) if (v>topQty){ topQty=v; topName=k; }
      const suggestions=[];
      if (topQty>=6) suggestions.push({title:`Consider prepping more ${topName} — ${topQty} in queue`, action:'prep-top'});
      if (longWaits.length) suggestions.push({title:`Expedite ${longWaits.length} long-waiting order(s)`, action:'expedite'});
      const readyAges = state.orders.filter(o=>o.status==='ready' && minutesSince(o.updatedAt)>=5);
      if (readyAges.length) suggestions.push({title:`Call out pickups — ${readyAges.length} ready for 5+ min`, action:'callout'});
      if (!suggestions.length) suggestions.push({title:'All good! Steady flow detected.', action:'none'});
      return suggestions;
    }

    function renderSuggestions(){
      const box = $('#suggestions');
      const s = generateSuggestions();
      box.innerHTML = s.map(x=>`
        <div class="flex items-center justify-between p-3 rounded-xl ring-1 ring-neutral-200">
          <div class="font-medium">${x.title}</div>
          ${x.action==='none' ? '' : `<button class="px-3 py-1.5 rounded-lg text-white" style="background-color: var(--coffee);" data-suggest="${x.action}">Apply</button>`}
        </div>
      `).join('');
      box.querySelectorAll('[data-suggest]').forEach(b=>b.addEventListener('click', handleSuggestion));
    }

    function handleSuggestion(e){
      const a = e.currentTarget.getAttribute('data-suggest');
      if (a==='prep-top'){
        // no-op placeholder; in real app we might increment batch prep counter
        alert('Heads up: Prepping more of the top item!');
      } else if (a==='expedite'){
        // move oldest pending to in progress
        const pend = state.orders.filter(o=>o.status==='waiting' || o.status==='in progress')
                                 .sort((a,b)=>a.createdAt-b.createdAt);
        pend.slice(0,3).forEach(o=>{ if (o.status==='waiting') o.status='in progress'; o.updatedAt=now(); });
      } else if (a==='callout'){
        alert('Calling out pickups for older ready orders!');
      }
      renderAll();
    }

    // ------------------------------
    // Actions
    // ------------------------------
    function getById(id){ return state.orders.find(o=>o.id===id); }

    function handleAction(e){
      const id = e.currentTarget.getAttribute('data-id');
      const act = e.currentTarget.getAttribute('data-action');
      const o = getById(id); if (!o) return;
      if (act==='start') { o.status='in progress'; o.updatedAt=now(); }
      if (act==='ready') { o.status='ready'; o.updatedAt=now(); }
      if (act==='reopen') { o.status='in progress'; o.updatedAt=now(); }
      if (act==='cancel') { if (confirm('Cancel this order?')) { o.status='cancelled'; o.updatedAt=now(); } }
      renderAll();
    }

    // ------------------------------
    // Filtering
    // ------------------------------
    function applyFilters(){
      const q = $('#searchInput').value.trim().toLowerCase();
      const s = $('#filterStatus').value;
      const p = $('#filterPay').value;
      state.filtered = state.orders.filter(o=>{
        const matchQ = !q || o.customer.toLowerCase().includes(q) || o.items.some(it=>it.name.toLowerCase().includes(q));
        const matchS = s==='all' || o.status===s;
        const matchP = p==='all' || o.payment===p;
        return matchQ && matchS && matchP;
      });
      renderOrders();
    }

    // ------------------------------
    // Auto-refresh: simulate progress
    // ------------------------------
    function simulateTick(){
      // advance oldest waiting to in progress, and some in progress to ready
      const waiting = state.orders.filter(o=>o.status==='waiting').sort((a,b)=>a.createdAt-b.createdAt);
      const inprog = state.orders.filter(o=>o.status==='in progress').sort((a,b)=>a.createdAt-b.createdAt);
      if (waiting[0] && Math.random()<0.7){ waiting[0].status='in progress'; waiting[0].updatedAt=now(); }
      if (inprog[0] && Math.random()<0.6){ inprog[0].status='ready'; inprog[0].updatedAt=now(); }
      // occasional cancellation of a waiting order
      if (waiting[1] && Math.random()<0.05){ waiting[1].status='cancelled'; waiting[1].updatedAt=now(); }
      renderAll();
    }

    function setIntervalFromSelect(){
      if (state.intervalId) { clearInterval(state.intervalId); state.intervalId=null; }
      const val = $('#refreshSelect').value;
      if (val==='off') return;
      state.intervalId = setInterval(simulateTick, Number(val)*1000);
    }

    // ------------------------------
    // Demo Data
    // ------------------------------
    function randomFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function makeRandomItems(){
      const items=[];
      const groups = ['drink','drink','drink','pastry','snack'];
      const count = Math.floor(Math.random()*3)+1; // 1-3 lines
      for (let i=0;i<count;i++){
        const group = randomFrom(groups);
        const menu = MENU[group];
        const base = randomFrom(menu);
        items.push({name: base.name, qty: Math.floor(Math.random()*3)+1, price: base.price, type: group});
      }
      return items;
    }

    function seed(n=5){
      for(let i=0;i<n;i++){
        const statusPool = ['waiting','waiting','in progress'];
        const o = {
          id: id(),
          customer: randomFrom(NAMES),
          items: makeRandomItems(),
          status: randomFrom(statusPool),
          payment: randomFrom(['cash','card','upi']),
          createdAt: now() - Math.floor(Math.random()*20)*60000, // within last 20 min
          updatedAt: now()
        };
        state.orders.unshift(o);
      }
      renderAll();
    }

    // ------------------------------
    // Bootstrap
    // ------------------------------
    function renderAll(){
      applyFilters();
      renderAlerts();
      renderSuggestions();
    }

    function init(){
      // Events
      $('#seedBtn').addEventListener('click', ()=>{
        const c = Math.max(1, Math.min(100, Number($('#seedCount').value)||5));
        seed(c);
      });
      $('#addDemoBtn').addEventListener('click', ()=> seed(1));
      $('#tickBtn').addEventListener('click', simulateTick);
      $('#refreshSelect').addEventListener('change', setIntervalFromSelect);
      $('#regenSuggestions').addEventListener('click', renderSuggestions);

      $('#searchInput').addEventListener('input', applyFilters);
      $('#filterStatus').addEventListener('change', applyFilters);
      $('#filterPay').addEventListener('change', applyFilters);
      $('#clearFilters').addEventListener('click', ()=>{ $('#searchInput').value=''; $('#filterStatus').value='all'; $('#filterPay').value='all'; applyFilters(); });

      seed(5);
      setIntervalFromSelect();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
